# Transcript Caching System

This document describes the new transcript caching functionality that has been added to the Video Transcriber application.

## Overview

The application now automatically saves and reuses transcripts for all processed videos, significantly reducing processing time and API costs for repeated video processing. The system uses **on-the-fly directory scanning** to ensure the video list is always accurate and in sync with the actual files.

## Features

### 1. Automatic Transcript Caching
- **Downloaded Videos**: Transcripts are saved next to the video file with `.transcript.json` extension
- **Local Videos**: Transcripts are saved in a dedicated `local_files` folder using MD5 hashing for identification

### 2. Smart File Identification
- **Downloaded Videos**: Use filename-based identification and directory scanning
- **Local Videos**: Use MD5 hash of the video file content for identification
  - Allows video files to be moved/renamed while still finding the cached transcript
  - Ensures the same video content always uses the same transcript cache

### 3. Real-time Directory Scanning
- **No Metadata Files**: Downloads list is generated by scanning directories in real-time
- **Always Accurate**: Manually deleted files are immediately reflected in the UI
- **Auto-Discovery**: Manually added video files are automatically detected
- **Robust**: No risk of metadata becoming out of sync with actual files

### 4. Recompute Functionality
- **Refresh Button**: Added at the bottom of the transcript panel with a recycle icon
- **Force Recompute**: Bypass cache and regenerate transcript from audio
- **Automatic Cache Update**: New transcript overwrites the old cached version

## File Structure

```
~/VideoTranscriber/Downloads/
‚îú‚îÄ‚îÄ YouTube/
‚îÇ   ‚îú‚îÄ‚îÄ youtube_videoId_title.mp4
‚îÇ   ‚îî‚îÄ‚îÄ youtube_videoId_title.transcript.json
‚îú‚îÄ‚îÄ GoogleDrive/
‚îÇ   ‚îú‚îÄ‚îÄ gdrive_fileId_title.mp4
‚îÇ   ‚îî‚îÄ‚îÄ gdrive_fileId_title.transcript.json
‚îî‚îÄ‚îÄ local_files/
    ‚îú‚îÄ‚îÄ metadata.json (for local video cache tracking)
    ‚îú‚îÄ‚îÄ transcript_[MD5_HASH].json
    ‚îî‚îÄ‚îÄ transcript_[MD5_HASH].json
```

## Directory Scanning Logic

The system automatically scans for video files with these extensions:
- `.mp4`, `.mkv`, `.avi`, `.mov`, `.wmv`, `.flv`, `.webm`

For each video file found:
1. **File metadata** is extracted (size, creation date)
2. **Transcript availability** is checked (looks for `.transcript.json`)
3. **Title extraction** from filename pattern (`source_id_title.ext`)
4. **Cache status** is determined and displayed to user

## User Experience Improvements

### Visual Indicators
- **üìù Transcript Icon**: Shows next to video titles that have cached transcripts
- **Cache Status**: "Transcript cached" appears in video metadata
- **Real-time Updates**: File deletions are immediately reflected when browsing
- **Error Handling**: Clear messages when files are missing or moved

### Performance Benefits
- **Instant Loading**: Cached transcripts load in milliseconds
- **Cost Savings**: No API calls for already-processed videos
- **Reliability**: Works offline for cached content
- **Always Current**: No stale metadata issues

### Robustness Features
- **Manual File Management**: Users can safely delete/move files in Downloads folder
- **Auto-refresh**: Download list updates automatically when files are missing
- **No Sync Issues**: No centralized metadata to become corrupted or out of sync

## Technical Implementation

### Core Components
1. **transcriptManager.js**: Handles transcript caching for local files
2. **downloadManager.js**: Now scans directories on-the-fly instead of using metadata files
3. **videoProcessor.js**: Modified to check cache first, save after processing
4. **ipcHandlers.js**: Added recompute transcript functionality
5. **UI Components**: Added recompute button and cache status indicators

### Scanning Functions
- `scanDirectoryForVideos(dirPath, source)`: Scans directory for video files and metadata
- `getDownloadHistory()`: Returns real-time scan results of all download directories
- `getStorageInfo()`: Calculates storage usage from actual files

### Legacy Compatibility
- `addToDownloadHistory()`: Now a no-op (files discovered automatically)
- `removeFromDownloadHistory()`: Now a no-op (deletions detected automatically)
- API structure preserved for frontend compatibility

## Error Handling

- **File Not Found**: Clear error messages with auto-refresh of file list
- **Corrupted Cache**: Cache files are ignored and regenerated automatically
- **Permission Errors**: Don't prevent video processing or directory scanning
- **Missing Directories**: Automatically created on first use

## Maintenance

The system is completely self-maintaining:
- **No Metadata Cleanup**: No centralized metadata files to manage
- **Automatic Discovery**: New files are found without manual intervention
- **Instant Sync**: File deletions/moves are immediately reflected
- **Zero Configuration**: Works out of the box with no setup required

## Migration from Previous Version

The new system automatically handles the transition:
- **Old Metadata**: Previous `.metadata.json` files are ignored but not deleted
- **Existing Files**: All existing downloaded videos are automatically discovered
- **Transcript Compatibility**: All existing transcript caches continue to work
- **Seamless Upgrade**: No user action required 